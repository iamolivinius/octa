var convertNodeToXML=function a(b,c){var d=b.prop("tagName").toLowerCase(),e="<"+d+">";return c?e+=b.html():b.children().each(function(){e+=a($(this),c)}),e+="</"+d+">"},convertNodeToPath=function(a){for(var b=[];"HTML"!==a.prop("tagName");)b.push(a.prop("tagName")),a=a.parent();return b.reverse().join(" ")},selector='<div id="selector"><div id="selector-top"></div><div id="selector-left"></div><div id="selector-right"></div><div id="selector-bottom"></div></div>',deactivate=function(){$("#selector").remove(),$(document).unbind("mousemove"),$(document).unbind("click",process)},select=function(a){var b={top:$("#selector-top"),left:$("#selector-left"),right:$("#selector-right"),bottom:$("#selector-bottom")};if(-1===a.target.id.indexOf("selector")&&"BODY"!==a.target.tagName&&"HTML"!==a.target.tagName){var c=$(a.target),d=c[0].getBoundingClientRect(),e=d.width,f=d.height;b.top.css({left:d.left-4,top:d.top-4,width:e+5}),b.bottom.css({left:d.left-3,top:d.top+f+1,width:e+4}),b.left.css({left:d.left-5,top:d.top-4,height:f+8}),b.right.css({left:d.left+e+1,top:d.top-4,height:f+8})}},process=function(a){a.stopImmediatePropagation(),a.preventDefault(),deactivate();var b=$(a.target);switch(a.data.mode){case"container":var c=convertNodeToXML(b,!1),d=b.parent().prop("class"),e=b.parent().prop("id"),f=null;f=d?"."+d.split(" ").join("."):e?"#"+e:convertNodeToPath(b.parent()),f+=" "+b.prop("tagName").toLowerCase(),chrome.extension.sendRequest({action:"add",type:"container",container:c,enclosing:f},function(){});break;case"field":var g=convertNodeToPath(b);chrome.extension.sendRequest({action:"add",type:"field",field:g},function(){});break;case"trigger":var h=b.prop("class"),i=b.prop("id"),j=null;j=h?"."+h.split(" ").join("."):i?"#"+i:convertNodeToPath(b),chrome.extension.sendRequest({action:"add",type:"trigger",trigger:j},function(){})}};chrome.runtime.onMessage.addListener(function(a){switch(a.action){case"selection":a.activate===!0?($("body").append(selector),$(document).mousemove(select),setTimeout(function(){$(document).on("click",{mode:a.mode},process)},300)):deactivate()}}),console.log("content script ready");